name: main_agent
version: 1.0.0
description: 有声绘本制作系统

agent:
  name: picture_book_agent
  version: 1.0.0
  type: main_agent
  
  system_prompt: |
    你是有声绘本制作助手，负责协调整个绘本生成流程。

    ## 你的职责：
    根据用户输入，使用工具生成绘本相关资源（图片和音频），然后将结果总结并返回给用户。

    ## 工作流程（每完成一步立即用write_todos更新状态为completed）：

    1. **解析用户输入**
       - 调用 parse_premise 工具解析为JSON格式
       - 完成后用 write_todos 标记此步骤为 completed

    2. **生成文生图提示词并保存到文件**
       - 调用 task 工具委派给 prompt_generator 子代理
       - prompt_generator会自动调用 write_file 保存提示词到文件（默认: image_prompt.txt）
       - 完成后用 write_todos 标记此步骤为 completed

    3. **生成绘本图片**
       - 调用 generate_image 工具，使用 promptFile 参数读取文件（promptFile: "image_prompt.txt"）
       - 不要使用 prompt 参数，避免长提示词占用上下文
       - 其他参数：size: "1024*1024", count: 1
       - 完成后用 write_todos 标记此步骤为 completed

    4. **生成台词**
       - 调用 generate_script_from_image 工具，传入 imagePath 为步骤3返回的图片路径（如 imagePath）
       - 完成后用 write_todos 标记此步骤为 completed

    5. **生成语音**
       - 使用步骤4返回的 lines，将 lines 中每项的 text 组成数组传入 synthesize_speech 的 texts 参数（voice: "chinese_female", format: "mp3"）
       - 完成后用 write_todos 标记此步骤为 completed

    6. **完成工作流并返回结果**
       - 调用 finalize_workflow 工具，传入生成的文件路径和台词
         - imagePath: 步骤3返回的图片路径（imagePath）
         - audioPath: 步骤5返回的音频路径（audioPaths 数组的第一个元素，即 audioPaths[0]）
         - scriptText: 步骤4返回的台词内容（可将 result.lines 用 JSON.stringify 传入，或传可读摘要）
       - 工具会自动检查文件是否存在并返回完成消息
       - 完成后用 write_todos 标记此步骤为 completed
       - 然后向用户展示绘本生成结果的完整摘要

    ## 关键要求：
    - 必须在每个步骤完成后立即调用 write_todos 更新进度
    - 严格按顺序执行，不要跳过或重复
    - 所有6个步骤的todos都要标记为completed
    - 最后向用户展示清晰的完成摘要
  
  storage:
    type: local
    path: ./outputs
  
  llm:
    model: qwen-plus-2025-07-28
    temperature: 0.7
    max_tokens: 4096
  
  # 调试配置
  debug:
    log_llm_calls: true      # 是否在控制台打印LLM调用
    save_llm_calls: true     # 是否保存LLM调用到文件

# 内置工具配置
tools:
  parse_premise:
    name: parse_premise
    description: 解析用户输入，提取前提变量（年龄、主题、风格、语言等）
    system_prompt: |
      请解析以下用户输入，提取前提变量，返回 JSON 格式，包含：age (年龄), theme (主题), style (风格), language (语言)。
      
      示例输入："生成5岁海洋主题绘本"
      示例输出：{"age": 5, "theme": "海洋", "style": "卡通", "language": "中文"}
      
      如果某些信息未提供，请使用合理的默认值。
    output_format:
      type: json
      schema:
        type: object
        properties:
          age:
            type: integer
            description: 目标年龄（岁）
            default: 4
          theme:
            type: string
            description: 绘本主题
          style:
            type: string
            description: 绘画风格
            default: "卡通"
          language:
            type: string
            description: 语言
            default: "中文"
        required:
          - theme

# MCP服务配置
mcp_services:
  t2i:
    enable: true
    type: t2i_mcp
    name: generate_image
    description: 生成绘本图片
    config_path: ./mcp/t2i_config.yaml
  
  tts:
    enable: true
    type: tts_mcp
    name: synthesize_speech
    description: 合成语音
    config_path: ./mcp/tts_config.yaml
  
  vl_script:
    enable: true
    type: vl_script_mcp
    name: generate_script_from_image
    description: 根据图片路径，用视觉模型生成台词及坐标
    config_path: ./mcp/vl_script_config.yaml

# SubAgent配置
sub_agents:
  prompt_generator:
    enable: true
    name: prompt_generator
    description: 根据前提变量生成文生图提示词
    config_path: ./sub_agents/prompt_gen.yaml

# 工作流配置
workflow:
  steps:
    - id: 1
      name: 解析用户输入
      tool: parse_premise
      required: true
    
    - id: 2
      name: 生成文生图提示词
      subagent: prompt_generator
      required: true
    
    - id: 3
      name: 生成绘本图片
      tool: generate_image
      required: true
    
    - id: 4
      name: 生成台词
      tool: generate_script_from_image
      required: true
    
    - id: 5
      name: 生成语音
      tool: synthesize_speech
      required: true
    
    - id: 6
      name: 完成工作流并返回结果
      tool: finalize_workflow
      required: true

# UI配置
ui:
  welcome:
    title: 欢迎使用儿童科普绘本生成助手
    subtitle: 我可以帮您为不同年龄段的儿童生成包含图片和语音的百科类科普绘本
    
    instructions:
      title: 请告诉我
      items:
        - 对象：想要了解的事物（如：老虎、挖掘机、向日葵）
        - 年龄：目标儿童的年龄段（如：2岁、5岁、8岁）
        - 风格：绘画风格（可选，如：卡通、手绘、写实）
    
    footer: 或者直接点击下方的快捷选项开始！
    
  quick_options:
    - label: 2岁宝宝看的老虎
      description: 适合低幼儿童的卡通风格
      prompt: 给2岁宝宝生成老虎的绘本
    
    - label: 5岁孩子的挖掘机
      description: 工程机械科普
      prompt: 给5岁孩子生成挖掘机的科普图
    
    - label: 3岁宝宝的恐龙
      description: 史前生物探索
      prompt: 3岁宝宝看的霸王龙
    
    - label: 7岁孩子的太阳系
      description: 天文知识启蒙
      prompt: 给7岁孩子生成太阳系的科普图
    
    - label: 4岁孩子的向日葵
      description: 植物生长过程
      prompt: 4岁孩子看的向日葵
    
    - label: 6岁孩子的消防车
      description: 特种车辆认知
      prompt: 给6岁孩子生成消防车的绘本

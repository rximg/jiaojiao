name: main_agent
version: 1.0.0
description: 有声绘本制作系统

agent:
  name: picture_book_agent
  version: 1.0.0
  type: main_agent
  
  system_prompt: |
    你是有声绘本制作助手：根据用户输入生成绘本图片与音频，并总结返回。

    ## 工作流程（每步完成后立即 write_todos 标记 completed）

    1. **提示词**：task 委派 prompt_generator，在 description 中传入用户回答（即用户本轮输入或用户描述），子代理会 write_file 到 image_prompt.txt
    2. **图片**：generate_image(promptFile: "image_prompt.txt", size: "1024*1024", count: 1)，勿用 prompt 参数
    3. **台词**：generate_script_from_image(imagePath: 步骤2的图片路径)
    4. **语音**：synthesize_speech(texts: 步骤3的 lines[].text, voice: "chinese_female", format: "mp3")
    5. **标注**：annotate_image_numbers(imagePath: 步骤2路径, lines: 步骤3的 lines)，输出 xxx_annotated.png
    6. **收尾**：finalize_workflow(imagePath: 步骤5标注图或步骤2图, audioPath: 步骤4的 audioPaths[0], scriptText: 步骤3的 lines)，再向用户展示完成摘要

    ## 要求
    - 严格按 1→6 顺序执行，每步完成即 write_todos
    - 6 步 todos 均需标记 completed，最后给出清晰摘要
  
  storage:
    type: local
    path: ./outputs
  
  llm:
    model: qwen3-max-2026-01-23
    temperature: 0.1
    max_tokens: 20000
  
  # 调试配置（详细追踪请用 LangSmith，此处仅保留简短控制台信息）
  debug:
    log_llm_calls: false
    save_llm_calls: false

# 主 Agent 内置工具（仅主 Agent 使用的工具；SubAgent 专用工具在各自 sub_agent 配置中）
tools:
  finalize_workflow: {}      # 检查文件并完成流程
  annotate_image_numbers: {} # 按坐标在图上画白底数字标签
# MCP服务配置
mcp_services:
  t2i:
    enable: true
    type: t2i_mcp
    name: generate_image
    description: 生成绘本图片
    config_path: ./mcp/t2i_config.yaml
  
  tts:
    enable: true
    type: tts_mcp
    name: synthesize_speech
    description: 合成语音
    config_path: ./mcp/tts_config.yaml
  
  vl_script:
    enable: true
    type: vl_script_mcp
    name: generate_script_from_image
    description: 根据图片路径，用视觉模型生成台词及坐标
    config_path: ./mcp/vl_script_config.yaml

# SubAgent配置
sub_agents:
  prompt_generator:
    enable: true
    name: prompt_generator
    description: 根据用户回答生成文生图提示词
    config_path: ./sub_agents/prompt_gen.yaml

# 工作流配置
workflow:
  steps:
    - id: 1
      name: 生成文生图提示词（传入用户回答）
      subagent: prompt_generator
      required: true
    
    - id: 2
      name: 生成绘本图片
      tool: generate_image
      required: true
    
    - id: 3
      name: 生成台词
      tool: generate_script_from_image
      required: true
    
    - id: 4
      name: 生成语音
      tool: synthesize_speech
      required: true
    
    - id: 5
      name: 标注图片序号
      tool: annotate_image_numbers
      required: true
    
    - id: 6
      name: 完成工作流并返回结果
      tool: finalize_workflow
      required: true

# UI配置
ui:
  welcome:
    title: 欢迎使用儿童科普绘本生成助手
    subtitle: 我可以帮您为不同年龄段的儿童生成包含图片和语音的百科类科普绘本
    
    instructions:
      title: 请告诉我
      items:
        - 对象：想要了解的事物（如：老虎、挖掘机、向日葵）
        - 年龄：目标儿童的年龄段（如：2岁、5岁、8岁）
        - 风格：绘画风格（可选，如：卡通、手绘、写实）
    
    footer: 或者直接点击下方的快捷选项开始！
    
  quick_options:
    - label: 2岁宝宝看的老虎
      description: 适合低幼儿童的卡通风格
      prompt: 给2岁宝宝生成老虎的绘本
    
    - label: 5岁孩子的挖掘机
      description: 工程机械科普
      prompt: 给5岁孩子生成挖掘机的科普图
    
    - label: 3岁宝宝的恐龙
      description: 史前生物探索
      prompt: 3岁宝宝看的霸王龙
    
    - label: 7岁孩子的太阳系
      description: 天文知识启蒙
      prompt: 给7岁孩子生成太阳系的科普图
    
    - label: 4岁孩子的向日葵
      description: 植物生长过程
      prompt: 4岁孩子看的向日葵
    
    - label: 6岁孩子的消防车
      description: 特种车辆认知
      prompt: 给6岁孩子生成消防车的绘本

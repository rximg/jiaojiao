# 万相-图像编辑2.6 API 详细说明
万相-图像编辑2.6（模型标识：wan2.6-image）是阿里云百炼平台推出的视觉生成模型API，支持**图像编辑**和**图文混排输出**两大核心能力，可通过简单的HTTP同步调用实现多样化的图像创作与编辑需求，适配多地域部署，接口设计简洁且扩展性强。

## 一、模型基础信息
| 项目         | 详情                                                                 |
|--------------|----------------------------------------------------------------------|
| 模型名称     | wan2.6-image（万相-图像编辑2.6）|
| 核心能力     | 图像编辑、图文混排输出（图文混排仅支持流式输出）|
| 输出图像规格 | 格式为PNG；分辨率/尺寸由`size`参数指定，总像素建议在1280*1280~1440*1440之间 |
| 调用方式     | HTTP同步调用（推荐大多数场景）|
| 地域支持     | 北京、新加坡、弗吉尼亚（各区域独立鉴权，不可混用）|

## 二、调用前提
1. 已在阿里云百炼平台获取**API Key**，并将其配置到环境变量（变量名：DASHSCOPE_API_KEY）；
2. 确认目标地域支持该模型，且使用对应地域的API Key，跨地域调用会导致鉴权失败/服务报错；
3. 图文混排场景需提前开启流式输出配置（详见下文**图文混排专属配置**）。

## 三、请求地址（HTTP同步调用）
各地域独立请求地址，需与API Key地域匹配：
| 地域       | 请求地址                                                              |
|------------|-----------------------------------------------------------------------|
| 北京       | `POST https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation` |
| 新加坡     | `POST https://dashscope-intl.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation` |
| 弗吉尼亚   | `POST https://dashscope-us.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation` |

## 四、请求配置
### 4.1 请求头（Headers）
所有参数均为`string`类型，必填项需严格配置：
| 参数名          | 是否必选 | 取值/说明                                                                 |
|-----------------|----------|--------------------------------------------------------------------------|
| Content-Type    | 是       | 固定为`application/json`                                                 |
| Authorization   | 是       | 身份认证，格式：`Bearer $DASHSCOPE_API_KEY`（替换为实际API Key）|
| X-DashScope-Sse | 否       | 仅**图文混排场景**需设为`enable`，用于启用流式输出；其他场景可忽略/不传    |

### 4.2 请求体（Request Body）
JSON格式，包含**模型指定、输入内容、参数配置**三大核心模块，所有字段严格区分类型，必填项不可缺省。
#### 核心字段总览
| 字段       | 类型     | 是否必选 | 说明                                                                 |
|------------|----------|----------|----------------------------------------------------------------------|
| model      | string   | 是       | 固定为`wan2.6-image`，指定调用的图像编辑模型                         |
| input      | object   | 是       | 输入内容容器，包含`messages`数组（核心输入）|
| parameters | object   | 是       | 生成参数配置，如尺寸、水印、是否开启图文混排等                       |

#### 1. input.messages 配置（核心输入）
仅支持**单轮对话**，数组内仅包含1个对象，对象属性如下：
| 属性   | 类型     | 是否必选 | 取值/说明                                                         |
|--------|----------|----------|------------------------------------------------------------------|
| role   | string   | 是       | 固定为`user`，表示消息发起者为用户                               |
| content| array    | 是       | 消息内容数组，**必须且仅包含1个text对象**，可按需添加多个image对象 |

##### content 子字段配置
| 子字段 | 类型     | 是否必选 | 取值/说明                                                                 |
|--------|----------|----------|--------------------------------------------------------------------------|
| text   | string   | 是       | 正向提示词，描述图像编辑/生成的内容、风格、构图；支持中英文，≤2000字符，超截自动截断 |
| image  | string   | 否       | 参考图像的**URL**或**Base64编码字符串**；支持格式：JPEG/JPG/PNG（无透明通道）/BMP/WEBP |

#### 2. parameters 配置（生成参数）
| 字段             | 类型      | 是否必选 | 取值/说明                                                                 |
|------------------|-----------|----------|--------------------------------------------------------------------------|
| prompt_extend    | bool      | 否       | 是否开启提示词智能改写；true（默认，提升效果，增加3-4秒耗时）/false        |
| watermark        | bool      | 否       | 是否添加右下角“AI生成”水印；false（默认，不添加）/true                    |
| n                | integer   | 否       | 生成图片数量；取值1~4，默认1；**按张计费**，测试建议设1                   |
| enable_interleave| bool      | 否       | 是否开启图文混排；true（开启）/false（默认，关闭）|
| size             | string    | 否       | 输出图像尺寸；格式`宽*高`，如1280*1280；推荐宽高比1:4~4:1                |
| stream           | 否        | 否       | 仅图文混排场景需设为`true`，配合X-DashScope-Sse启用流式输出               |
| max_images       | integer   | 否       | 图文混排场景指定最大生成图片数，如3                                      |

### 4.3 图文混排专属配置
开启图文混排（`enable_interleave=true`）时，**必须同时满足以下3项配置**，否则调用失败：
1. 请求头添加`X-DashScope-Sse: enable`；
2. parameters内设置`stream: true`；
3. 可通过`max_images`指定图文混排的最大生成图片数。

## 五、典型调用示例（CURL）
### 5.1 图像编辑（参考多图生成/编辑）
基于两张参考图的风格/背景，编辑生成指定内容，基础同步调用：
```curl
curl --location 'https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation' \
--header 'Content-Type: application/json' \
--header "Authorization: Bearer $DASHSCOPE_API_KEY" \
--data '{
 "model": "wan2.6-image",
 "input": {
 "messages": [
 {
 "role": "user",
 "content": [
 {
 "text": "参考图1的风格和图2的背景，生成番茄炒蛋"
 },
 {
 "image": "https://cdn.wanx.aliyuncs.com/tmp/pressure/umbrella1.png"
 },
 {
 "image": "https://img.alicdn.com/imgextra/i3/O1CN01SfG4J41UYn9WNt4X1_!!6000000002530-49-tps-1696-960.webp"
 }
 ]
 }
 ]
 },
 "parameters": {
 "prompt_extend": true,
 "watermark": false,
 "n": 1,
 "enable_interleave": false,
 "size": "1280*1280"
 }
}'
```

### 5.2 图文混排（流式输出）
生成带图片的教程类内容，开启图文混排并配置流式输出：
```curl
curl --location 'https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation' \
--header 'Content-Type: application/json' \
--header "Authorization: Bearer $DASHSCOPE_API_KEY" \
--header 'X-DashScope-Sse: enable' \
--data '{
 "model": "wan2.6-image",
 "input": {
 "messages": [
 {
 "role": "user",
 "content": [
 {
 "text": "给我一个3张图辣椒炒肉教程"
 }
 ]
 }
 ]
 },
 "parameters": {
 "max_images": 3,
 "size": "1280*1280",
 "stream": true,
 "enable_interleave":true
 }
}'
```

## 六、响应结果说明
### 6.1 成功响应（JSON格式）
调用成功时返回生成结果、用量统计、请求ID，核心为`output`内的图像URL，示例：
```json
{
 "output": {
 "choices": [
 {
 "finish_reason": "stop",
 "message": {
 "content": [
 {
 "image": "https://dashscope-result-bj.oss-cn-beijing.aliyuncs.com/xxxx.png?Expires=xxx",
 "type": "image"
 }
 ],
 "role": "assistant"
 }
 }
 ],
 "finished": true
 },
 "usage": {
 "image_count": 1,
 "input_tokens": 0,
 "output_tokens": 0,
 "size": "1280*1280",
 "total_tokens": 0
 },
 "request_id": "815505c6-7c3d-49d7-b197-xxxxx"
}
```
#### 成功响应核心字段
| 字段         | 说明                                                                 |
|--------------|----------------------------------------------------------------------|
| output.choices.finish_reason | 任务停止原因，自然完成固定为`stop`|
| output.choices.message.content | 生成结果，`image`为图像URL，`type`固定为`image`|
| usage        | 用量统计，包含生成图片数、图像尺寸等                                 |
| request_id   | 唯一请求标识，用于问题排查                                           |

**重要**：生成的图像URL**仅保留24小时**，超时自动清除，需及时保存图像文件。

### 6.2 失败响应（JSON格式）
调用失败时返回请求ID、错误码、错误信息，示例：
```json
{
 "request_id": "a4d78a5f-655f-9639-8437-xxxxxx",
 "code": "InvalidParameter",
 "message": "num_images_per_prompt must be 1"
}
```
#### 失败响应核心字段
| 字段     | 说明                                                                 |
|----------|----------------------------------------------------------------------|
| request_id | 唯一请求标识，用于阿里云技术支持排查问题                             |
| code     | 错误码，如`InvalidParameter`（参数错误）、`AuthFailed`（鉴权失败）|
| message  | 错误详情描述，明确失败原因，指导参数修正/问题解决                     |

## 七、关键注意事项
1. **地域与鉴权**：北京、新加坡、弗吉尼亚的API Key和请求地址一一对应，不可混用，否则直接鉴权失败；
2. **内容限制**：`input.messages.content`中必须且仅能有1个`text`对象，可添加多个参考`image`对象；
3. **计费规则**：生成图片数量`n`直接影响费用，费用=模型单价×图片张数，调用前需确认目标地域的模型价格；
4. **流式输出**：仅图文混排场景支持流式输出，且必须同时配置`X-DashScope-Sse: enable`和`stream: true`；
5. **图像有效期**：所有生成的图像URL有效期为24小时，需在有效期内下载并保存本地，超时无法访问；
6. **参数约束**：`text`提示词≤2000字符，`n`取值1~4，图像尺寸宽高比建议1:4~4:1，避免参数超限导致调用失败。